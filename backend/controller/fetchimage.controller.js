import OpenAI from "openai";
import dotenv from "dotenv";
import { errorHandler } from "../utils/error.js";
import { Completions } from "openai/resources/completions.mjs";

dotenv.config();

const openai = new OpenAI({ apiKey: process.env.OPENAI_API });

export const fetchImageController = async (req, res, next) => {
  try {
    const image_url =
      "data:image/webp;base64,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aXRsZWQgZGVzaWduIC0gMTwvcmRmOmxpPgogICAgICAgIDwvcmRmOkFsdD4KICAgICAgICA8L2RjOnRpdGxlPgogICAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgoKICAgICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogICAgICAgIHhtbG5zOkF0dHJpYj0naHR0cDovL25zLmF0dHJpYnV0aW9uLmNvbS9hZHMvMS4wLyc+CiAgICAgICAgPEF0dHJpYjpBZHM+CiAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSdSZXNvdXJjZSc+CiAgICAgICAgPEF0dHJpYjpDcmVhdGVkPjIwMjMtMDEtMTg8L0F0dHJpYjpDcmVhdGVkPgogICAgICAgIDxBdHRyaWI6RXh0SWQ+NTYxM2M0NTctN2IyOC00MzFlLWJkYmMtYTNkYzFjODkyMGFlPC9BdHRyaWI6RXh0SWQ+CiAgICAgICAgPEF0dHJpYjpGYklkPjUyNTI2NTkxNDE3OTU4MDwvQXR0cmliOkZiSWQ+CiAgICAgICAgPEF0dHJpYjpUb3VjaFR5cGU+MjwvQXR0cmliOlRvdWNoVHlwZT4KICAgICAgICA8L3JkZjpsaT4KICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgPC9BdHRyaWI6QWRzPgogICAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgoKICAgICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogICAgICAgIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgICAgICAgPHBkZjpBdXRob3I+QWpheSBHb3BhbGFtPC9wZGY6QXV0aG9yPgogICAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgoKICAgICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogICAgICAgIHhtbG5zOnhtcD0naHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyc+CiAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5DYW52YTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICAgICAgIDwvcmRmOlJERj4KICAgICAgICA8L3g6eG1wbWV0YT4A";

    const prompt = `
      Please analyze the provided image of an import document and extract the relevant details to match the following JSON format. The document should include information such as name, age, date of birth, Aadhaar number, address details, pincode, and mobile number. Here is the required JSON structure:
  
      {
        "name": "",
        "age": "",
        "dob": "",
        "aadhaar_number": "",
        "address": {
          "street": "",
          "locality": "",
          "city": "",
          "state": "",
          "country": ""
        },
        "pincode": "",
        "mobile_number": ""
      }
  
      Please ensure that the extracted data matches this structure accurately. Your response should be a valid JSON object only, starting with "{" and ending with "}". Do not include any additional text or explanations. If certain fields are missing or ambiguous, make a note of it within the JSON object. 
    `;

    const completion = await openai.chat.completions.create({
      model: process.env.OPENAI_MODEL,
      messages: [
        {
          role: "system",
          content: prompt,
        },
        {
          role: "user",
          content: [
            { type: "text", text: "Here is my image" },
            {
              type: "image_url",
              image_url: {
                url: image_url,
              },
            },
          ],
        },
      ],
    });

    if (completion) {
      try {
        const result = JSON.parse(completion.choices[0].message.content);
        return res.status(200).json(result);
      } catch (error) {
        return errorHandler(500, "Error parsing response JSON");
      }
    } else {
      return errorHandler(404, "Error while generating response");
    }
  } catch (error) {
    next(error);
  }
};
